<!-- rule_19.4.html
copyright: &copy; 2013 Programming Research
   module: M2CM-3.2-QAC-8.1.2
  purpose: MISRA-C:2004 Rules explanation file
  history: auto-created on 30-Jul-13
-->
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
-->
<HTML><HEAD><TITLE>QA C Help - Rule 19.4</TITLE>
         <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
         <meta http-equiv="Content-Style-Type" content="text/css">
         <link href="css/message.css" rel="stylesheet" type="text/css">
</HEAD><BODY>
<table class="heading">
<tr class="heading">
<td class="heading" rowspan=4 width="85px"><img src="QAC.png"></td>
<td class="heading" align="right" width="11px">
<a href="rule_19.3.html"><img src="left.png" alt="[previous]"></a>
</td>
<td class="heading_number"><span style="white-space:nowrap">MISRA-C:2004&nbsp;&nbsp;Rule&nbsp;&nbsp;19.4:&nbsp;&nbsp;(Required)</span></td>
<td class="heading" align="left" width="11px">
<a href="rule_19.5.html"><img src="right.png" alt="[next]"></a>
</td>
<td class="heading"/>
<td class="heading_message">C macros shall only expand to a braced initialiser, a constant, a string literal, a parenthesised expression, a type qualifier, a storage class specifier, or a do-while-zero construct.</td>
<tr class="heading">
<td class="heading" height="1px" colspan=7 background="prqa_sep.png"/><td class="heading" width="76px"><img src="prqa_right.png"/></td></tr>
<tr class="heading">
<td colspan=4  class="heading_category"></td>
<td width="70%" class="heading_verbose"/>
<td class="heading_message"/>
</tr>
</table>
These are the only permitted uses of macros.  Storage class specifiers and type qualifiers include keywords such as extern, static and const.  Any other use of #define could lead to unexpected behaviour when substitution is made, or to very hard-to-read code.
<P>
In particular macros shall not be used to define statements or parts of statements except the use of the do-while construct.  Nor shall macros redefine the syntax of the language.  All brackets of whatever type ( ) { } [ ] in the macro replacement list shall be balanced.
<P>
The do-while-zero construct (see example below) is the only permitted mechanism for having complete statements in a macro body.  The do-while-zero construct is used to wrap a series of one or more statements and ensure correct behaviour.  Note: the semicolon must be omitted from the end of the macro body.
<P>
For example:
<p><pre class="example">
<code class="comment">&#x2F;&#x2A; The following are compliant &#x2A;&#x2F;</code>
<code class="preprocessor">#define PI 3.14159F</code><code class="comment">                  &#x2F;&#x2A; Constant                      &#x2A;&#x2F;</code>
<code class="preprocessor">#define XSTAL 10000000</code><code class="comment">               &#x2F;&#x2A; Constant                      &#x2A;&#x2F;</code>
<code class="preprocessor">#define CLOCK &#x28; XSTAL&#x2F;16 &#x29;</code><code class="comment">           &#x2F;&#x2A; Constant expression           &#x2A;&#x2F;</code>
<code class="preprocessor">#define PLUS2&#x28; X &#x29; &#x28; &#x28; X &#x29; &#x2B; 2 &#x29;</code><code class="comment">     &#x2F;&#x2A; Macro expanding to expression &#x2A;&#x2F;</code>
<code class="preprocessor">#define STOR extern</code><code class="comment">                  &#x2F;&#x2A; storage class specifier       &#x2A;&#x2F;</code>
<code class="preprocessor">#define INIT&#x28; value &#x29; &#x7B; &#x28; value &#x29;, 0, 0&#x7D;</code><code class="comment">   &#x2F;&#x2A; braced initialiser      &#x2A;&#x2F;</code>
<code class="preprocessor">#define CAT &#x28;PI&#x29;</code><code class="comment">                     &#x2F;&#x2A; parenthesised expression      &#x2A;&#x2F;</code> 
<code class="preprocessor">#define FILE_A</code><code class="string"> "filename.h"</code><code class="comment">          &#x2F;&#x2A; string literal                &#x2A;&#x2F;</code>
<code class="preprocessor">#define READ_TIME_32&#x28;&#x29; \</code>
   <code class="keyword">do</code> \
   <code class="operator">&#x7B;</code> \
      DISABLE_INTERRUPTS<code class="operator">&#x28;</code><code class="operator">&#x29;</code>; \
      time_now <code class="operator">&#x3D;</code> <code class="operator">&#x28;</code> uint32_t<code class="operator">&#x29;</code>TIMER_HI <code class="operator">&lt;</code><code class="operator">&lt;</code> <code class="number">16</code>; \
      time_now <code class="operator">&#x3D;</code> time_now <code class="operator">&#x7C;</code> <code class="operator">&#x28;</code> uint32_t <code class="operator">&#x29;</code>TIMER_LO; \
      ENABLE_INTERRUPTS<code class="operator">&#x28;</code><code class="operator">&#x29;</code>; \
   <code class="operator">&#x7D;</code> <code class="keyword">while</code> <code class="operator">&#x28;</code> <code class="number">0</code> <code class="operator">&#x29;</code>                     <code class="operator">&#x2F;</code><code class="operator">&#x2A;</code> example of <code class="keyword">do</code><code class="operator">&#x2D;</code><code class="keyword">while</code><code class="operator">&#x2D;</code>zero      <code class="operator">&#x2A;</code><code class="operator">&#x2F;</code>


<code class="operator">&#x2F;</code><code class="operator">&#x2A;</code> the following are NOT compliant <code class="operator">&#x2A;</code><code class="operator">&#x2F;</code>
#define int32_t <code class="type">long</code>       <code class="operator">&#x2F;</code><code class="operator">&#x2A;</code> use <code class="keyword">typedef</code> instead                     <code class="operator">&#x2A;</code><code class="operator">&#x2F;</code>
#define STARTIF <code class="keyword">if</code><code class="operator">&#x28;</code>        <code class="operator">&#x2F;</code><code class="operator">&#x2A;</code> unbalanced <code class="operator">&#x28;</code><code class="operator">&#x29;</code> and language redefinition <code class="operator">&#x2A;</code><code class="operator">&#x2F;</code>
#define CAT PI             <code class="operator">&#x2F;</code><code class="operator">&#x2A;</code> non<code class="operator">&#x2D;</code>parenthesised expression            <code class="operator">&#x2A;</code><code class="operator">&#x2F;</code>

</pre><P><HR><P>
<B>QAC messages that encompass this guideline:</B>
<P>
<TABLE WIDTH="90%" BORDER=1 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3409.html">3409</A></TD>
<TD VALIGN=TOP WIDTH="90%"> The replacement list of function-like macro '%s' is not enclosed in (). </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3411.html">3411</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro defined with unbalanced brackets, parentheses or braces. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3412.html">3412</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro defines an unrecognized code-fragment. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3413.html">3413</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro definition could be replaced by a typedef. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3431.html">3431</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro defines an operator, a punctuator or a control statement keyword. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3452.html">3452</A></TD>
<TD VALIGN=TOP WIDTH="90%"> The replacement list of object-like macro '%s' is not enclosed in (). </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3458.html">3458</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro defines a braced code statement block. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3460.html">3460</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro defines a type specifier keyword. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="3461.html">3461</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Macro defines a storage-class specifier/type qualifier sequence. </TD>
</TR>
</TABLE>
<P><HR>
<TABLE WIDTH="100%">
<TR>
<TD WIDTH="355px">
<IMG SRC="prqa_left.png"/>
</TD>
<TD COLSPAN=2 BACKGROUND="prqa_middle.png"/>
</TR>
</TABLE>
<P>
<BR><I><A HREF="misra.html">(c)  The Motor Industry Research Association, 2004</A></I>
<TABLE WIDTH="100%">
  <TR VALIGN="MIDDLE">
    <TD WIDTH="30%">
      <I><B>QA C Source Code Analyser 8.1.2</B></I>
      <BR><I><B>MISRA-C:2004 Compliance Module 3.2</B></I>
      <BR><I>&copy; 2013 Programming Research</I>
      <BR><I>
        www.programmingresearch.com
      </I>
    </TD>
    <TD ALIGN="CENTER" WIDTH="60%">
      <A HREF="PersonIndex.html">Personality Groups</A> | 
      <A HREF="Glossary.html">Glossary</A> | 
      <A HREF="MessageIndex.html">Message Index</A>
      | <A HREF="MISRA-C_2004Index.html">MISRA-C:2004 Rule Index</A>
    </TD>
    <TD ALIGN="RIGHT" WIDTH="10%">
      <A HREF="messages.htm">Contents</A>
    </TD>
  </TR>
</TABLE>
</BODY></HTML>
