<!-- rule_18.4.html
copyright: &copy; 2013 Programming Research
   module: M2CM-3.2-QAC-8.1.2
  purpose: MISRA-C:2004 Rules explanation file
  history: auto-created on 30-Jul-13
-->
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
-->
<HTML><HEAD><TITLE>QA C Help - Rule 18.4</TITLE>
         <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
         <meta http-equiv="Content-Style-Type" content="text/css">
         <link href="css/message.css" rel="stylesheet" type="text/css">
</HEAD><BODY>
<table class="heading">
<tr class="heading">
<td class="heading" rowspan=4 width="85px"><img src="QAC.png"></td>
<td class="heading" align="right" width="11px">
<a href="rule_18.3.html"><img src="left.png" alt="[previous]"></a>
</td>
<td class="heading_number"><span style="white-space:nowrap">MISRA-C:2004&nbsp;&nbsp;Rule&nbsp;&nbsp;18.4:&nbsp;&nbsp;(Required)</span></td>
<td class="heading" align="left" width="11px">
<a href="rule_19.1.html"><img src="right.png" alt="[next]"></a>
</td>
<td class="heading"/>
<td class="heading_message">Unions shall not be used.</td>
<tr class="heading">
<td class="heading" height="1px" colspan=7 background="prqa_sep.png"/><td class="heading" width="76px"><img src="prqa_right.png"/></td></tr>
<tr class="heading">
<td colspan=4  class="heading_category"></td>
<td width="70%" class="heading_verbose"/>
<td class="heading_message"/>
</tr>
</table>
Rule <!--RNAME[18.3]--> prohibits the reuse of memory areas for unrelated purposes.  However, even when memory is being reused for related purposes, there is still a risk that the data may be misinterpreted.  Therefore, this rule prohibits the use of unions for any purpose.
<P>
It is recognised nonetheless that there are situations in which the careful use of unions is desirable in constructing an efficient implementation.  In such situations, deviations to this rule are considered acceptable provided that all relevant implementation-defined behaviour is documented.  This might be achieved in practice by referencing the implementation section of the compiler manuals from the design documentation.  The kinds of implementation behaviour that might be relevant are:
<P>
* padding - how much padding is inserted at the end of the union
<P>
* alignment - how are members of any structures within the union aligned
<P>
* endianness - is the most significant byte of a word stored at the lowest or highest memory address
<P>
* bit-order - how are bits numbered within bytes and how are bits allocated to bit fields
<P>
The use of deviations is acceptable for (a) packing and unpacking of data, for example when sending and receiving messages, and (b) implementing variant records provided that the variants are differentiated by a common field.  Variant records without a differentiator are not considered suitable for use in any situation.<P>
<P><FONT SIZE=+1><B>Example Code:</B></FONT>
<PRE>
<code>
<pre class="example"><code class="comment">&#x2F;&#x2A; PRQA S 3205 &#x2B;&#x2B; &#x2A;&#x2F;</code>

<code class="preprocessor">#include</code><code class="string"> "misra.h"</code>
<code class="preprocessor">#include</code><code class="string"> "m2cmex.h"</code>

<code class="keyword">union</code> test
<code class="operator">&#x7B;</code>
   S8 <code class="operator">&#x2A;</code>c;
   S32 i;
<code class="operator">&#x7D;</code>;

<code class="keyword">extern</code> S16 test_1804<code class="operator">&#x28;</code> <code class="type">void</code> <code class="operator">&#x29;</code>
<code class="operator">&#x7B;</code>
   <code class="keyword">union</code> test mytest;<code class="comment">                  &#x2F;&#x2A; MISRA Violation &#x2A;&#x2F;</code>

   <code class="keyword">return</code> <code class="number">0</code>;
<code class="operator">&#x7D;</code>

</pre>
</code>
</PRE>
<P><HR><P>
<B>QAC messages that encompass this guideline:</B>
<P>
<TABLE WIDTH="90%" BORDER=1 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="0750.html">0750</A></TD>
<TD VALIGN=TOP WIDTH="90%"> A union type specifier has been defined. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="0759.html">0759</A></TD>
<TD VALIGN=TOP WIDTH="90%"> An object of union type has been defined. </TD>
</TR>
</TABLE>
<P><HR>
<TABLE WIDTH="100%">
<TR>
<TD WIDTH="355px">
<IMG SRC="prqa_left.png"/>
</TD>
<TD COLSPAN=2 BACKGROUND="prqa_middle.png"/>
</TR>
</TABLE>
<P>
<BR><I><A HREF="misra.html">(c)  The Motor Industry Research Association, 2004</A></I>
<TABLE WIDTH="100%">
  <TR VALIGN="MIDDLE">
    <TD WIDTH="30%">
      <I><B>QA C Source Code Analyser 8.1.2</B></I>
      <BR><I><B>MISRA-C:2004 Compliance Module 3.2</B></I>
      <BR><I>&copy; 2013 Programming Research</I>
      <BR><I>
        www.programmingresearch.com
      </I>
    </TD>
    <TD ALIGN="CENTER" WIDTH="60%">
      <A HREF="PersonIndex.html">Personality Groups</A> | 
      <A HREF="Glossary.html">Glossary</A> | 
      <A HREF="MessageIndex.html">Message Index</A>
      | <A HREF="MISRA-C_2004Index.html">MISRA-C:2004 Rule Index</A>
    </TD>
    <TD ALIGN="RIGHT" WIDTH="10%">
      <A HREF="messages.htm">Contents</A>
    </TD>
  </TR>
</TABLE>
</BODY></HTML>
