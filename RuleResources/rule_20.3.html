<!-- rule_20.3.html
copyright: &copy; 2013 Programming Research
   module: M2CM-3.2-QAC-8.1.2
  purpose: MISRA-C:2004 Rules explanation file
  history: auto-created on 30-Jul-13
-->
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
-->
<HTML><HEAD><TITLE>QA C Help - Rule 20.3</TITLE>
         <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
         <meta http-equiv="Content-Style-Type" content="text/css">
         <link href="css/message.css" rel="stylesheet" type="text/css">
</HEAD><BODY>
<table class="heading">
<tr class="heading">
<td class="heading" rowspan=4 width="85px"><img src="QAC.png"></td>
<td class="heading" align="right" width="11px">
<a href="rule_20.2.html"><img src="left.png" alt="[previous]"></a>
</td>
<td class="heading_number"><span style="white-space:nowrap">MISRA-C:2004&nbsp;&nbsp;Rule&nbsp;&nbsp;20.3:&nbsp;&nbsp;(Required)</span></td>
<td class="heading" align="left" width="11px">
<a href="rule_20.4.html"><img src="right.png" alt="[next]"></a>
</td>
<td class="heading"/>
<td class="heading_message">The validity of values passed to library functions shall be checked.</td>
<tr class="heading">
<td class="heading" height="1px" colspan=7 background="prqa_sep.png"/><td class="heading" width="76px"><img src="prqa_right.png"/></td></tr>
<tr class="heading">
<td colspan=4  class="heading_category"></td>
<td width="70%" class="heading_verbose"/>
<td class="heading_message"/>
</tr>
</table>
Many functions in the standard C libraries are not required by the ISO standard [2] to check the validity of parameters passed to them.  Even where checking is required by the standard, or where compiler writers claim to check parameters, there is no guarantee that adequate checking will take place.  Therefore the programmer shall provide appropriate checks of input values for all library functions which have a restricted input domain (standard libraries, other bought in libraries, and in-house libraries).
<P>
Examples of functions that have a restricted domain and need checking are:
<P>
* many of the maths functions in math.h, for example:
        negative numbers must not be passed to the sqrt or log functions;
        the second parameter of fmod should not be zero
<P>
* toupper and tolower: some implementations can produce unexpected results when the function toupper is passed a parameter which is not a lower case letter (and similarly for tolower)
<P>
* the character testing functions in ctype.h exhibit undefined behaviour if passed invalid values.
<P>
* the abs function applied to the most negative integer gives undefined behaviour.
<P>
Although most of the math library functions in math.h define allowed input domains, the values they return when a domain error occurs may vary from one compiler to another.  Therefore pre-checking the validity of the input values is particularly important for these functions.
<P>
The programmer should identify any domain constraints which should sensibly apply to a function being used (which may or may not be documented in the standard), and provide appropriate checks that the input value(s) lies within this domain.  Of course, the value may be restricted further, if required, by knowledge of what the parameter represents and what constitutes a sensible range of values for the parameter.
<P>
There are a number of ways in which the requirements of this rule might be satisfied, including the following:
<P>
* Check the values before calling the function
<P>
* Design checks into the function.  This is particularly applicable for in-house designed libraries, though it could apply to bought-in libraries if the supplier can demonstrate that they have built in the checks.
<P>
* Produce "wrapped" versions of functions, that perform the checks then call the original function.
<P>
* Demonstrate statically that the input parameters can never take invalid values.
<P>
Note that when checking a floating-point parameter to a function, that has a singularity at zero, it may be appropriate to perform a test of equality to zero.  This will require a deviation to Rule <!--RNAME[13.3]-->.  However it will usually still be necessary to test to a tolerance around zero (or any other singularity) if the magnitude of the value of the function tends to infinity as the parameter tends to zero, so as to prevent overflow occurring.<P>
<P><FONT SIZE=+1><B>Example Code:</B></FONT>
<PRE>
<code>
<pre class="example"><code class="comment">&#x2F;&#x2A; PRQA S 3205 &#x2B;&#x2B; &#x2A;&#x2F;</code>

<code class="preprocessor">#include</code><code class="string"> &lt;stdio.h&gt;</code><code class="comment">                      &#x2F;&#x2A; MISRA Violation &#x2A;&#x2F;</code>
<code class="preprocessor">#include</code><code class="string"> &lt;string.h&gt;</code><code class="comment">                     &#x2F;&#x2A; MISRA Violation &#x2A;&#x2F;</code>
<code class="preprocessor">#include</code><code class="string"> "misra.h"</code>
<code class="preprocessor">#include</code><code class="string"> "m2cmex.h"</code>

<code class="keyword">extern</code> S16 test_2003<code class="operator">&#x28;</code> <code class="type">void</code> <code class="operator">&#x29;</code>
<code class="operator">&#x7B;</code>
   PC   buf[<code class="number">5</code>];
   PC  <code class="operator">&#x2A;</code>str1 <code class="operator">&#x3D;</code> NULL;
   PC  <code class="operator">&#x2A;</code>str2 <code class="operator">&#x3D;</code><code class="string"> "Reaction %d"</code>;

   <code class="operator">&#x28;</code><code class="type">void</code><code class="operator">&#x29;</code>printf<code class="operator">&#x28;</code>str1, <code class="number">10</code><code class="operator">&#x29;</code>;<code class="comment">              &#x2F;&#x2A; MISRA Violation &#x2A;&#x2F;</code>

   <code class="operator">&#x28;</code><code class="type">void</code><code class="operator">&#x29;</code>memcpy<code class="operator">&#x28;</code>buf, str2, <code class="number">11u</code><code class="operator">&#x29;</code>;<code class="comment">        &#x2F;&#x2A; MISRA Violation &#x2A;&#x2F;</code>

   <code class="keyword">return</code> <code class="number">1</code>;
<code class="operator">&#x7D;</code>

</pre>
</code>
</PRE>
<P><HR><P>
<B>QAC messages that encompass this guideline:</B>
<P>
<TABLE WIDTH="90%" BORDER=1 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2810.html">2810</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Constant: Dereference of NULL pointer. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2811.html">2811</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Definite: Dereference of NULL pointer. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2812.html">2812</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Apparent: Dereference of NULL pointer. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2840.html">2840</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Constant: Dereference of an invalid pointer value. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2841.html">2841</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Definite: Dereference of an invalid pointer value. </TD>
</TR>
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2842.html">2842</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Apparent: Dereference of an invalid pointer value. </TD>
</TR>
</TABLE>
<P><HR><P>
<B>Related rules:</B>
<P>
<TABLE WIDTH="90%" BORDER=1 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP WIDTH="15%" ALIGN=CENTER> <A HREF="rule_1.2.html">Rule&nbsp;&nbsp;1.2</A></TD>
<TD VALIGN=TOP WIDTH="85%"> No reliance shall be placed on undefined or unspecified behaviour.</TD>
</TR>

<TR>
<TD VALIGN=TOP WIDTH="15%" ALIGN=CENTER> <A HREF="rule_21.1.html">Rule&nbsp;&nbsp;21.1</A></TD>
<TD VALIGN=TOP WIDTH="85%"> Minimisation of run-time failures shall be ensured by the use of at least one of (a) static analysis tools/techniques; (b) dynamic analysis tools/techniques; (c) explicit coding of checks to handle run-time faults</TD>
</TR>

</TABLE>
<P><HR>
<TABLE WIDTH="100%">
<TR>
<TD WIDTH="355px">
<IMG SRC="prqa_left.png"/>
</TD>
<TD COLSPAN=2 BACKGROUND="prqa_middle.png"/>
</TR>
</TABLE>
<P>
<BR><I><A HREF="misra.html">(c)  The Motor Industry Research Association, 2004</A></I>
<TABLE WIDTH="100%">
  <TR VALIGN="MIDDLE">
    <TD WIDTH="30%">
      <I><B>QA C Source Code Analyser 8.1.2</B></I>
      <BR><I><B>MISRA-C:2004 Compliance Module 3.2</B></I>
      <BR><I>&copy; 2013 Programming Research</I>
      <BR><I>
        www.programmingresearch.com
      </I>
    </TD>
    <TD ALIGN="CENTER" WIDTH="60%">
      <A HREF="PersonIndex.html">Personality Groups</A> | 
      <A HREF="Glossary.html">Glossary</A> | 
      <A HREF="MessageIndex.html">Message Index</A>
      | <A HREF="MISRA-C_2004Index.html">MISRA-C:2004 Rule Index</A>
    </TD>
    <TD ALIGN="RIGHT" WIDTH="10%">
      <A HREF="messages.htm">Contents</A>
    </TD>
  </TR>
</TABLE>
</BODY></HTML>
