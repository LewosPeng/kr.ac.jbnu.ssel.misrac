<!-- rule_12.11.html
copyright: &copy; 2013 Programming Research
   module: M2CM-3.2-QAC-8.1.2
  purpose: MISRA-C:2004 Rules explanation file
  history: auto-created on 30-Jul-13
-->
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
-->
<HTML><HEAD><TITLE>QA C Help - Rule 12.11</TITLE>
         <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
         <meta http-equiv="Content-Style-Type" content="text/css">
         <link href="css/message.css" rel="stylesheet" type="text/css">
</HEAD><BODY>
<table class="heading">
<tr class="heading">
<td class="heading" rowspan=4 width="85px"><img src="QAC.png"></td>
<td class="heading" align="right" width="11px">
<a href="rule_12.10.html"><img src="left.png" alt="[previous]"></a>
</td>
<td class="heading_number"><span style="white-space:nowrap">MISRA-C:2004&nbsp;&nbsp;Rule&nbsp;&nbsp;12.11:&nbsp;&nbsp;(Advisory)</span></td>
<td class="heading" align="left" width="11px">
<a href="rule_12.12.html"><img src="right.png" alt="[next]"></a>
</td>
<td class="heading"/>
<td class="heading_message">Evaluation of constant unsigned integer expressions should not lead to wrap-around.</td>
<tr class="heading">
<td class="heading" height="1px" colspan=7 background="prqa_sep.png"/><td class="heading" width="76px"><img src="prqa_right.png"/></td></tr>
<tr class="heading">
<td colspan=4  class="heading_category"></td>
<td width="70%" class="heading_verbose"/>
<td class="heading_message"/>
</tr>
</table>
Because unsigned integer expressions do not strictly overflow, but instead wrap around in a modular way, any constant unsigned integer expressions which in effect 'overflow' will not be detected by the compiler.  Although there may be good reasons at run-time to rely on the modular arithmetic provided by unsigned integer types, the reasons for using it at compile-time to evaluate a constant expression are less obvious.  Any instance of an unsigned integer constant expression wrapping around is therefore likely to indicate a programming error.
<P>
This rule applies equally to all phases of the translation process.  Constant expressions that the compiler chooses to evaluate at compile time are evaluated in such a way that the results are identical to those that would be obtained by evaluation on the target with the exception of those appearing in conditional preprocessing directives.  For such directives, the usual rules of arithmetic (see section 6.4 of ISO/IEC 9899:1990 [2]) apply but the int and unsigned int types behave instead as if they were long and unsigned long respectively.
<P>
For example, on a machine with a 16-bit int type and a 32-bit long type:
<p><pre class="example">
<code class="preprocessor">#define START   0x8000</code>
<code class="preprocessor">#define END     0xFFFF</code>
<code class="preprocessor">#define LEN     0x8000</code>

<code class="preprocessor">#if &#x28; &#x28; START &#x2B; LEN &#x29; &gt; END &#x29;</code>
<code class="preprocessor">#error Buffer Overrun</code><code class="comment"> &#x2F;&#x2A; OK because START and LEN are unsigned long &#x2A;&#x2F;</code>
<code class="preprocessor">#endif</code>

<code class="preprocessor">#if &#x28; &#x28; &#x28; END &#x2D; START &#x29; &#x2D; LEN &#x29; &lt; 0 &#x29;</code>
<code class="preprocessor">        #error Buffer Overrun</code>
<code class="comment">        &#x2F;&#x2A; Not OK&#x3A; subtraction result wraps around to 0xFFFFFFFF &#x2A;&#x2F;</code>
<code class="preprocessor">#endif</code>

<code class="comment">&#x2F;&#x2A; contrast the above START &#x2B; LEN with the following &#x2A;&#x2F;</code>
<code class="keyword">if</code> <code class="operator">&#x28;</code> <code class="operator">&#x28;</code> START <code class="operator">&#x2B;</code> LEN <code class="operator">&#x29;</code> <code class="operator">&gt;</code> END <code class="operator">&#x29;</code>
<code class="operator">&#x7B;</code>
   error <code class="operator">&#x28;</code><code class="string"> "Buffer overrun"</code> <code class="operator">&#x29;</code>;
<code class="comment">      &#x2F;&#x2A; Not OK&#x3A; START &#x2B; LEN wraps around to 0x0000 due to unsigned
                                                     int arithmetic &#x2A;&#x2F;</code>
<code class="operator">&#x7D;</code>

</pre><P><HR><P>
<B>QAC messages that encompass this guideline:</B>
<P>
<TABLE WIDTH="90%" BORDER=1 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP WIDTH="10%" ALIGN=CENTER> <A HREF="2910.html">2910</A></TD>
<TD VALIGN=TOP WIDTH="90%"> Constant: Wraparound in unsigned arithmetic operation. </TD>
</TR>
</TABLE>
<P><HR>
<TABLE WIDTH="100%">
<TR>
<TD WIDTH="355px">
<IMG SRC="prqa_left.png"/>
</TD>
<TD COLSPAN=2 BACKGROUND="prqa_middle.png"/>
</TR>
</TABLE>
<P>
<BR><I><A HREF="misra.html">(c)  The Motor Industry Research Association, 2004</A></I>
<TABLE WIDTH="100%">
  <TR VALIGN="MIDDLE">
    <TD WIDTH="30%">
      <I><B>QA C Source Code Analyser 8.1.2</B></I>
      <BR><I><B>MISRA-C:2004 Compliance Module 3.2</B></I>
      <BR><I>&copy; 2013 Programming Research</I>
      <BR><I>
        www.programmingresearch.com
      </I>
    </TD>
    <TD ALIGN="CENTER" WIDTH="60%">
      <A HREF="PersonIndex.html">Personality Groups</A> | 
      <A HREF="Glossary.html">Glossary</A> | 
      <A HREF="MessageIndex.html">Message Index</A>
      | <A HREF="MISRA-C_2004Index.html">MISRA-C:2004 Rule Index</A>
    </TD>
    <TD ALIGN="RIGHT" WIDTH="10%">
      <A HREF="messages.htm">Contents</A>
    </TD>
  </TR>
</TABLE>
</BODY></HTML>
