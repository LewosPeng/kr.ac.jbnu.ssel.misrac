<!-- rule_18.3.html
copyright: &copy; 2013 Programming Research
   module: M2CM-3.2-QAC-8.1.2
  purpose: MISRA-C:2004 Rules explanation file
  history: auto-created on 30-Jul-13
-->
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
-->
<HTML><HEAD><TITLE>QA C Help - Rule 18.3</TITLE>
         <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
         <meta http-equiv="Content-Style-Type" content="text/css">
         <link href="css/message.css" rel="stylesheet" type="text/css">
</HEAD><BODY>
<table class="heading">
<tr class="heading">
<td class="heading" rowspan=4 width="85px"><img src="QAC.png"></td>
<td class="heading" align="right" width="11px">
<a href="rule_18.2.html"><img src="left.png" alt="[previous]"></a>
</td>
<td class="heading_number"><span style="white-space:nowrap">MISRA-C:2004&nbsp;&nbsp;Rule&nbsp;&nbsp;18.3:&nbsp;&nbsp;(Required)</span></td>
<td class="heading" align="left" width="11px">
<a href="rule_18.4.html"><img src="right.png" alt="[next]"></a>
</td>
<td class="heading"/>
<td class="heading_message">An area of memory shall not be reused for unrelated purposes.</td>
<tr class="heading">
<td class="heading" height="1px" colspan=7 background="prqa_sep.png"/><td class="heading" width="76px"><img src="prqa_right.png"/></td></tr>
<tr class="heading">
<td colspan=4  class="heading_category"></td>
<td width="70%" class="heading_verbose"/>
<td class="heading_message"/>
</tr>
</table>
This rule refers to the technique of using memory to store some data, and then using the same memory to store unrelated data at some other time during the execution of the program.   Clearly it relies on the two different pieces of data existing at disjoint periods of the program's execution, and never being required simultaneously.
<P>
This practice is not recommended for safety-related systems as it brings with it a number of dangers.  For example: a program might try to access data of one type from the location when actually it is storing a value of the other type (e.g. due to an interrupt).  The two types of data may align differently in the storage, and encroach upon other data.  Therefore the data may not be correctly initialised every time the usage switches.  The practice is particularly dangerous in concurrent systems.
<P>
However it is recognised that sometimes such storage sharing may be required for reasons of efficiency.  Where this is the case it is essential that measures are taken to ensure that the wrong type of data can never be accessed, that data is always properly initialised and that it is not possible to access parts of other data (e.g. due to alignment differences).  The measures taken shall be documented and justified in the deviation that is raised against this rule.
<P>
This might be achieved by the use of unions, or various other means.
<P>
Note that there is no intention in the MISRA-C guidelines to place restrictions on how a compiler actually translates source code as the user generally has no effective control over this.   So for example, memory allocation within the compiler whether dynamic heap, dynamic stack or static, may vary significantly with only slight code changes even at the same level of optimisation.  (Note also that some optimisation may legitimately take place even when the user makes no specific request for this.)<P>
<P><FONT SIZE=+1><B>Example Code:</B></FONT>
<PRE>
<code>
<pre class="example"><code class="comment">&#x2F;&#x2A; PRQA S 3206,3218 &#x2B;&#x2B; &#x2A;&#x2F;</code>

<code class="preprocessor">#include</code><code class="string"> "misra.h"</code>
<code class="preprocessor">#include</code><code class="string"> "m2cmex.h"</code>

<code class="preprocessor">#define BSPACE 10000</code>

<code class="keyword">static</code> PC text_buffer[ BSPACE ];

<code class="keyword">static</code> <code class="type">void</code> process_commands<code class="operator">&#x28;</code> PC <code class="operator">&#x2A;</code>work <code class="operator">&#x29;</code>;
<code class="keyword">static</code> <code class="type">void</code> process_report<code class="operator">&#x28;</code> PC <code class="operator">&#x2A;</code>work <code class="operator">&#x29;</code>;

<code class="keyword">extern</code> S16 test_1803<code class="operator">&#x28;</code> <code class="type">void</code> <code class="operator">&#x29;</code>
<code class="operator">&#x7B;</code>
<code class="comment">   &#x2F;&#x2A; Use text_buffer for command processing purposes. &#x2A;&#x2F;</code>

   process_commands<code class="operator">&#x28;</code> text_buffer <code class="operator">&#x29;</code>;

<code class="comment">   &#x2F;&#x2A; Use text_buffer for report processing purposes &#x2A;&#x2F;</code>

   process_report<code class="operator">&#x28;</code> text_buffer <code class="operator">&#x29;</code>;
   <code class="keyword">return</code> <code class="number">1</code>;
<code class="operator">&#x7D;</code>

<code class="keyword">static</code> <code class="type">void</code> process_commands<code class="operator">&#x28;</code> PC <code class="operator">&#x2A;</code>work <code class="operator">&#x29;</code>
<code class="operator">&#x7B;</code>
<code class="comment">   &#x2F;&#x2A; Use work to process commands &#x2A;&#x2F;</code>
<code class="operator">&#x7D;</code>

<code class="keyword">static</code> <code class="type">void</code> process_report<code class="operator">&#x28;</code> PC <code class="operator">&#x2A;</code>work <code class="operator">&#x29;</code>
<code class="operator">&#x7B;</code>
<code class="comment">   &#x2F;&#x2A; Use work to process report &#x2A;&#x2F;</code>
<code class="operator">&#x7D;</code>

</pre>
</code>
</PRE>
<P><HR><P><B>No QAC messages cover this rule.
</B><P>
<P><HR>
<TABLE WIDTH="100%">
<TR>
<TD WIDTH="355px">
<IMG SRC="prqa_left.png"/>
</TD>
<TD COLSPAN=2 BACKGROUND="prqa_middle.png"/>
</TR>
</TABLE>
<P>
<BR><I><A HREF="misra.html">(c)  The Motor Industry Research Association, 2004</A></I>
<TABLE WIDTH="100%">
  <TR VALIGN="MIDDLE">
    <TD WIDTH="30%">
      <I><B>QA C Source Code Analyser 8.1.2</B></I>
      <BR><I><B>MISRA-C:2004 Compliance Module 3.2</B></I>
      <BR><I>&copy; 2013 Programming Research</I>
      <BR><I>
        www.programmingresearch.com
      </I>
    </TD>
    <TD ALIGN="CENTER" WIDTH="60%">
      <A HREF="PersonIndex.html">Personality Groups</A> | 
      <A HREF="Glossary.html">Glossary</A> | 
      <A HREF="MessageIndex.html">Message Index</A>
      | <A HREF="MISRA-C_2004Index.html">MISRA-C:2004 Rule Index</A>
    </TD>
    <TD ALIGN="RIGHT" WIDTH="10%">
      <A HREF="messages.htm">Contents</A>
    </TD>
  </TR>
</TABLE>
</BODY></HTML>
